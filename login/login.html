<!DOCTYPE html>

<html lang="en">
    <head>
        <title>STARboard login</title>
        <meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Manrope&family=Montserrat+Subrayada:wght@700&family=Playfair+Display:ital,wght@1,600&family=Raleway&display=swap" rel="stylesheet">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Manrope&family=Montserrat+Subrayada:wght@700&family=Open+Sans&family=Playfair+Display:ital,wght@1,600&family=Raleway:wght@400;600&display=swap" rel="stylesheet">
        <link href="login.css" rel="stylesheet">


        <script>
            function toggleStudentInfo() {
                let student_info = document.getElementById('student-info');

                if (student_info.style.display === "none") {
                    student_info.style.display = "block";
                } else {
                    student_info.style.display = "none";
                }
            }

            function toggleLogin() {
                let login = document.getElementById("login-form");
                let reg = document.getElementById("reg-form");

                if (login.style.display === "none") {
                    login.style.display = "block";
                    reg.style.display = "none";
                } else {
                    login.style.display = "none";
                    reg.style.display = "block";
                }
            }

            function sendAccountCreationRequest() {
                let username = document.getElementById("username-reg").value;
                let password = document.getElementById("password-reg").value;
                let first_name = document.getElementById("first-name").value;
                let last_name = document.getElementById("last-name").value;
                let email = document.getElementById("email").value;
                let student_id = document.getElementById("student-id").value;

                // get account types from form input
                let checked = document.querySelectorAll('input[name=acct-type]:checked');
                let account_types = [];
                checked.forEach(type => account_types.push(type.id));

                // get registered courses from form input
                let courses = document.getElementById("courses");
                let reg_courses = [];
                let course;
                for (let c=0; c<courses.children.length; c++) {
                    course = courses.children[c].children[0]; // access nested input element
                    if (course.value.length > 0) {
                        reg_courses.push(course.value);
                    }
                }
            
                try {
                    const syncRequest = new XMLHttpRequest();
                    syncRequest.open("POST", "register.php", false);
                    syncRequest.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                    syncRequest.send(`username=${username}&password=${password}&firstname=${first_name}
                    &lastname=${last_name}&email=${email}&accounttypes=${JSON.stringify(account_types)}
                    &studentid=${student_id}&courses=${JSON.stringify(reg_courses)}`);

                    if (syncRequest.status === 200) {
                        document.getElementById("reg-form").innerHTML = syncRequest.responseText;
                    }
                } catch (exception) {
                    alert("Request failed. Please try again.");
                }
            }

            function sendLoginRequest() {
                let username = document.getElementById("username-login").value;
                let password = document.getElementById("password-login").value;

                try {
                    const syncRequest = new XMLHttpRequest();
                    syncRequest.open("POST", "login.php", false);
                    syncRequest.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                    syncRequest.send(`username=${username}&password=${password}`);

                    if (syncRequest.status === 200) {
                        document.body.innerHTML = syncRequest.responseText;
                        let scripts = document.body.getElementsByTagName("script");

                        if (scripts.length > 0) {
                            eval(scripts[0].text); // execute the declaration code for our returned functions so that the browser knows they exist
                            save_ticket_in_cookie(); // create a cookie on the user's browser with their ticket number
                            redirect(); // redirect to the user's dashboard
                        }
                    }
                }
                catch (exception) {
                    alert("Request failed. Please try again.");
                }
            }
        </script>
    </head>

    <body>
    <!--- Display main background image and website name: -->
    <div class="backgroundImage">
        <div class="backgroundImageText">
            <img src="https://upload.wikimedia.org/wikipedia/en/thumb/2/29/McGill_University_CoA.svg/1200px-McGill_University_CoA.svg.png"
                 style="height:60px; width:50px;">
            <span style="color: #8d99ae">STAR</span><span style="font-weight: 100">board</span>
            <div class = "backgroundImageHeader">
                McGill's SOCS TA Record Board
            </div>
        </div>
    </div>

    <div class="mainPage">
        <hr><!--- Shaddow -->

        <!--- Display login form: -->
        <div id="login-form">
            <div class="headerFontBlue" style="font-size: 25px;">Log In</div>

            <form>
                Username: <input id="username-login" type="text" name="username"><br>
                Password: <input id="password-login" type="password" name="password"><br>
                
                <button class = "style_button" type="button" onclick="sendLoginRequest()">Login</button>
            </form>

            <!---Register button: -->
            <div class="headerFontBlue">
                Don't have an account yet?
            </div>

            <button class = "style_button" onclick="toggleLogin()">Get on Board</button>
        </div>

        <div id="reg-form" style="display:none;">
            <div class="headerFontBlue" style="font-size: 25px;">Create New Account</div>
            <form>
                Username: <input id="username-reg" type="text" name="username"><br>
                Password: <input id="password-reg" type="password" name="password"><br>
                First Name: <input id="first-name" type="text" name="first-name"><br>
                Last Name: <input id="last-name" type="text" name="last-name"><br>
                Email: <input id="email" type="email" name="email"><br>
                
                Account type: 
    
                <input type="checkbox" id="student" name="acct-type" onclick="toggleStudentInfo()">
                <label for="student">Student</label>
                <input type="checkbox" id="professor" name="acct-type">
                <label for="professor">Professor</label>
                <input type="checkbox" id="admin" name="acct-type">
                <label for="admin">TA Administrator</label>
                <input type="checkbox" id="TA" name="acct-type">
                <label for="TA">Teaching Assistant</label>           
                <input type="checkbox" id="sys-operator" name="acct-type">
                <label for="sys-operator">System Operator</label>     
    
                <div id="student-info" style="display:none">
                    <!-- TODO: change this to a drop-down menu of courses where the 
                                user can pick as many as they want -->
                    Student ID: <input id="student-id" type="number" minlength="9" maxlength="9" style="width:100px"><br>
                    Registered Courses:
                    <ol id="courses">
                        <li><input id="course-1" type="text" name="course-1"></li>
                        <li><input id="course-2" type="text" name="course-2"></li>
                        <li><input id="course-3" type="text" name="course-3"></li>
                        <li><input id="course-4" type="text" name="course-4"></li>
                        <li><input id="course-5" type="text" name="course-5"></li>
                        <li><input id="course-6" type="text" name="course-6"></li>
                    </ol>
                </div>
    
                <br>
                <button type="button" onclick="toggleLogin()">Back to Login</button> 
                <button type="button" onclick="sendAccountCreationRequest()">Register</button>
            </form>
        </div>

        <!--- STARboard for students: -->
        <div class = "forStudents">
            <div class = "headerFontBlue">
                <h2>STARBoard for Students</h2>
            </div>
            <ul>
                <li>Create an account</li>
                <li>Rate teaching assistants by course</li>
                <li>Provide anonymous, constructive feedback to TA's</li>
            </ul>
        </div>

        <!--- STARboard for TAs: -->
        <div class = "forTAs">
            <div class = "headerFontRed">
                <h2>STARBoard for TAs</h2>
            </div>
            <ul>
                <li>View office hours and teaching responsibilities</li>
                <li>Access course notes, reminders, links, announcement, and more</li>
                <li>Chat with professors and other TAs</li>
            </ul>

        </div>


        <!--- STARboard for profs: -->
        <div class = "forProfs">
            <div class = "headerFontBlue">
                <h2>STARBoard for Professors</h2>
            </div>
            <ul>
                <li>View TA performance logs </li>
                <li>Create a TA wishlist for your courses</li>
                <li>Access complete TA reports</li>
                <li>Post TA responsibilities</li>
            </ul>

            <!---TODO: Create simple footer -->

        </div>
    </div>

    </body>
</html>