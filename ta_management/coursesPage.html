
<html>
<head>
    <title>STARboard Courses</title>
    <!--- Style sheet: ---->
    <link href="websiteShell.css" rel="stylesheet">
    <link href="coursesPage.css" rel="stylesheet">

    <!--- Icons: ---->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/font-awesome.min.css">

    <!--- Fonts: ---->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope&family=Montserrat+Subrayada:wght@700&family=Playfair+Display:ital,wght@1,600&family=Raleway&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope&family=Montserrat+Subrayada:wght@700&family=Open+Sans&family=Playfair+Display:ital,wght@1,600&family=Raleway:wght@400;600&display=swap" rel="stylesheet">

    


</head>
<body onload="updateMessages()">

    <div class = "topNav">

        <!--- TOPNAV: Logo and website name --->
    
        <img class = "topNavLogo" src="https://cdn.freebiesupply.com/logos/large/2x/mcgill-university-1-logo-png-transparent.png">
        <div class="logoText">
            STAR<span style = "color: white">board</span>
        </div>
    
    
        <!--- RATINGS BUTTON--->
        <a class="topNavOption" onclick="menuItemSelected('ratings')" id="ratings">
            <i class="fa fa-thumbs-up" aria-hidden="true"></i>RATINGS
        </a>
    
        <!--- COURSES BUTTON WITH DROP-DOWN--->
        <div class = "topNavOption" onclick="menuItemSelected('courses')" id="courses">
            <div class="dropDownMenu">
    
                <!--- COURSES BUTTON--->
                <a class="dropDownButton" onclick="toggleDropDown('courses_dropdown')">
                    <i class="fa fa-book" aria-hidden="true"></i>
                    COURSES
                    <i class="fa fa-angle-down" aria-hidden="true"></i>
                </a>
    
                <!--- DROP-DOWN--->
                <div class="dropDown_contents" style="display: none;" id="courses_dropdown">
                    <!--- TODO: Personalize te course list for each user -->
                    <a href="#"><i class="fa fa-bookmark" aria-hidden="true"></i> COMP 307</a>
                    <a href="#"><i class="fa fa-bookmark" aria-hidden="true"></i> COMP 424</a>
                    <a href="#"><i class="fa fa-bookmark" aria-hidden="true"></i> COMP 322</a>
                </div>
            </div>
        </div>
    
        <!--- ADMIN BUTTON--- (FOR ADMIN AND SYSOP ONLY)-->
        <div class="topNavOption" id="admin" onclick="menuItemSelected('admin')" id="admin">
            <i class="fa fa-sliders" aria-hidden="true"></i><a class = "buttonLabel" id="adminButton"> ADMIN</a>
        </div>
    
        <!--- SYSTEM BUTTON WITH DROP-DOWN--- (FOR SYSOP ONLY)-->
        <div class = "topNavOption" onclick="menuItemSelected('system')" id="system">
            <div class="dropDownMenu">
                <!--- SYSTEM BUTTON--->
                <a class="dropDownButton" onclick="toggleDropDown('system_dropdown')">
                    <i class="fa fa-cog" aria-hidden="true"></i>
                    SYSTEM
                    <i class="fa fa-angle-down" aria-hidden="true"></i>
                </a>
                <!--- DROP-DOWN--->
                <div class="dropDown_contents" style="display: none;"  id="system_dropdown">
                    <a href="#"><i class="fa fa-users" aria-hidden="true"></i> Manage users</a>
                    <a href="#"><i class="fa fa-user-plus" aria-hidden="true"></i> Import professor</a>
                    <a href="#"><i class="fa fa-upload" aria-hidden="true"></i> Import course</a>
                </div>
            </div>
        </div>
    
        <!--- SIGNOUT BUTTON WITH DROP-DOWN--->
        <div class = "topNavOption" onclick="menuItemSelected('signout')" id="signout">
            <div class="dropDownMenu">
                <!--- SIGN OUT BUTTON--->
                <a class="dropDownButton" onclick="toggleDropDown('signout_dropDown')">
                    <i class="fa fa-user-circle-o" aria-hidden="true"></i>
                    SIGN-OUT
                    <i class="fa fa-angle-down" aria-hidden="true"></i>
                </a>
                <!--- DROP-DOWN--->
                <div class="dropDown_contents" style="display: none;"  id="signout_dropDown">
                    <a href="#">
                        <i class="fa fa-sign-out" aria-hidden="true"></i>
                        Confirm sign-out
                    </a>
                </div>
            </div>
        </div>
    
        <!--- HAMBURGER BUTTON to toggle showing menu options--- (PHONE MODE ONLY)-->
        <a  class="hamburger" onclick="showTopNavOptions()" >
            <i class="fa fa-bars" style = "color: white;"></i>
        </a>
    </div>
    
    <!--- MAIN CONTENT OF WEBPAGE: UNIQUE FOR EACH PAGE --->
    <div class = "contentSection">
    

    <!--- MESSAGE CHANNEL --->
    <div class = "messageChannel" id="messageChannel">
        <div id="messageChannelContents">
            <span class="title">Message board</span>

            <!--- CLOSE MESSAGE CHANNEL --->
            <div class="closebtn" id="closeMessagesButton" onclick="closeMessages()"> 
                <i class="fa fa-times" aria-hidden="true" style="color: rgba(43, 46, 66, 0.6)"></i>
            </div>
            <div class ="messageHistory" id="msgHist">
                There was an issue loading your message history. 
            </div>
            <!---Message and send button-->
            <div class="inputAndButton">
                <input class = "messageInput" type="text" placeholder="Send a message..." id="msg" name ="msg" autocomplete="off">
                <button  class="sendButton" value="Submit" onclick="messageSent()">
                <i class="fa fa-paper-plane" aria-hidden="true" ></i>
                </button>
            </div>
        </div>
    </div>
        
        
<!--- OTHER TA MANAGEMENT INFO --->
<div id="main">

    <!--- DISPLAY THE CURRENT COURSE --->
    <div class = "courseTitle">
        TA management: COMP307
    </div>

    <!--- BUTTON TO OPEN MESSAGE CHANNEL --->
    <div class = "displayMessagesButton" id="openMessagesButton" onclick="openMessages()">
    <i class="fa fa-comments-o" aria-hidden="true" style="color: white"></i>  
    </div>
    
    <!--- MESSAGE CHANNEL GETS MOVED INSIDE "MAIN" FOR PHONE/TABLET MODES--->
    <div class="responsiveMessageChannel" id="responsiveMsgChannel">

    </div>

    <!--- SELECT A TA TO MANAGE (TAs CAN'T VIEW THIS) --->
    <div class="courseInfo">
        <span class="title">TA selected:</span>
        <span class="TAselected" id="selectedTA">none</span> 
        
        <select class="chooseTA" onchange="selectTA()" id="TAselectionDropDown">
            <!--- use php to load TA names from DB-->
        </select>
    </div>

    <!--- TA OH AND RESPOSIBILITIES (TAs and PROFS can see this) --->
    <div class = "courseInfo">
        <div class="title">Office hours and responsibilities</div> 
       <!---Load info from database:--> 
            <div class="taInfo" id="taInfo">
               
            </div>
        
        <!---Edit info:--> 
        <button class="editButton" onClick = "toggleEditTAInfo()" value="Edit" name="Edit">
            Edit info <i class="fa fa-pencil" aria-hidden="true"></i>
        </button>
       <div class="editInfo" id="editInfo" style="display: none">
           <div class="editInfoInput">
               <!---Edit OH DAY:--> 
                <label for="weekday">Office hour day: </label>
                <select id="weekday">
                    <option value="">Select a day</option>
                    <option value="Monday">Monday</option>
                    <option value="Tuesday">Tuesday</option>
                    <option value="Wednesday">Wednesday</option>
                    <option value="Thursday">Thursday</option>
                    <option value="Friday">Friday</option>
                </select>
           </div>
           <!---Edit OH times:--> 
            <div class="editInfoInput">
                <label for="startTime">Start time: </label>
                <input type="time" id="startTime">

                <label for="endTime">End time: </label>
                <input type="time" id="endTime">
            </div>
            <!---Edit OH location:--> 
            <div class="editInfoInput">
                <label for="location">Office hour location: </label>
                <input type="text" id="location" placeholder="example: Trotier room 3103" class = "editInfoInput">
            </div>
            <!---Edit responsibilities:--> 
            <div class="editInfoInput">
                <label for="responsibilities">TA responsibilities: </label>
                <input type="text" id="responsibilities" placeholder="example: grading assignments" class = "editInfoInput">
            </div>
            
            <!---Updates the TA info to the new information:--> 
            <button class="smallEditButton" onclick="updateTAInfo()">
                Save and close
            </button>
            <!---Closes the dropdown:--> 
            <button class="smallEditButton" onclick="toggleEditTAInfo()">
                Discard changes
            </button>
        </div>
    </div>

    <!---TA PERFORMANCE LOG (PROF ONLY):--> 
    <div class = "courseInfo">
        <div class="title">TA preformance log</div> 
        <!---DISPLAY PERFORMANCE LOG :--> 
        <div class="taPerformLogs" id="taPerformLogs">
            No performance logs to display.
        </div>
        
        <!---WRITE A TA PERFORMANCE LOG :--> 
        <input name="taPreformance" id="taPerform"  class="performanceInput" placeholder="Comment on your TA's performance...">
        <button class="editPerformButton" onclick="updateTAPerform()" >
            Save changes
            <i class="fa fa-check" aria-hidden="true"></i>
        </button> 
    </div>

    <!---TA PERFORMANCE WISH LIST (PROF ONLY):--> 
    <div class="courseInfo">
        <div class="title">TA Wish List</div> 
        <div class="wishList" id="wishList">
            Your wish-list is currently empty.
        </div>
        <!---WRITE A TA PERFORMANCE LOG :--> 
        <input name="addToWishList" id="addToWishList"  class="performanceInput" placeholder="Add a TA to your wish-list...">
        <button class="editPerformButton" onclick="updateTAWishList()" >
            Save changes
            <i class="fa fa-check" aria-hidden="true"></i>
        </button> 

    </div>

</div>

    <!---Little success message which pops up when changes are written to DB:-->
    <div id="successMessage">Records updated successfully.</div>
    </div>
    
    
    
<script>
    var CURRENT_COURSE="COMP307";
    var CURRENT_TA;
    var CURRENT_PROF="Dr Maddy";
    var CURRENT_TERM = "W2022";




function openMessages() {
    
    document.getElementById("messageChannel").style.height = "80%";
    document.getElementById("messageChannel").style.width = "45%";
    document.getElementById("messageChannel").style.padding = "20px";
    document.getElementById("main").style.marginLeft = "50%";
    document.getElementById("main").style.width = "50%";
    document.getElementById("displayMessagesButton").style.display="none";
    
  
}

function closeMessages() {
  document.getElementById("messageChannel").style.width = "0%";
  document.getElementById("messageChannel").style.height = "0%";
  document.getElementById("messageChannel").style.padding = "0px";
  document.getElementById("main").style.marginLeft= "0%";
  document.getElementById("main").style.width = "100%";
  
}

function selectTA()
{
    var selection = document.getElementById("TAselectionDropDown").value;
    document.getElementById("selectedTA").innerHTML = selection;
    CURRENT_TA=selection;
    getTAPreform();
    displayTAInfo();
} 

function toggleCourseInfo(content_id)
{
    let content = document.getElementById(content_id);
    //console.log(content_id);
    console.log(content.className);
    if (content.style.display === "block")
    {
        content.style.display = "none";
    }
    else
    {
        content.style.display = "block";
    }
}

function update_TA_OH_Responsibilities()
{

    toggleEditTAInfo();//toggle showing the edit view
    showSuccessMessage(); //display a  success message
}

function showSuccessMessage() {
    // Get the snackbar DIV
    var x = document.getElementById("successMessage");

    // Add the "show" class to DIV
    x.className = "show";

    // After 3 seconds, remove the show class from DIV
    setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
}

function updateMessages() {
    try{
        let course = CURRENT_COURSE;
        let username = CURRENT_PROF;//todo
        const req = new XMLHttpRequest();
        req.open("POST", "channelMessages.php", false);
        req.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        req.send(`username=${username}&course=${course}`);
        document.getElementById("msgHist").innerHTML = req.responseText;
        
    }catch (exception)
    {
        alert("Request failed.");
    }
    //move scrollbar to bottom:
    document.getElementById("msgHist").scrollTop = document.getElementById("msgHist").scrollHeight;

    //update messaages every 5 seconds:
    setTimeout(updateMessages, 5000);
}

function displayTAInfo()
{
    let username = CURRENT_TA;
    let course = "COMP307"; //TODO
    try{
        const req = new XMLHttpRequest();
        req.open("POST", "displayTAInfo.php", false);
        req.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        req.send(`username=${username}&course=${course}`);
        let response = req.responseText;
        document.getElementById("taInfo").innerHTML = response;
        
    }catch (exception)
    {
        alert("Request failed.");
    }
}

function updateTAInfo()
{
    let username = CURRENT_TA;
    let course = "COMP307"; //TODO
    let ohDay = document.getElementById("weekday").value;
    let ohStart = document.getElementById("startTime").value;
    let ohEnd = document.getElementById("endTime").value;
    let ohLocation = document.getElementById("location").value;
    let responsibilities = document.getElementById("responsibilities").value;
    console.log(username);
    console.log(ohDay);
    console.log(ohStart);
    console.log(ohEnd);
    console.log(ohLocation);
    console.log(responsibilities);
    try{
        const req = new XMLHttpRequest();
        req.open("POST", "updateTAInfo.php", false);
        req.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        req.send(`username=${username}&course=${course}&ohDay=${ohDay}&ohStart=${ohStart}&ohEnd=${ohEnd}
                &ohLocation=${ohLocation}&responsibilities=${responsibilities}`);
        
    }catch (exception)
    {
        alert("Request failed.");
    }
    displayTAInfo();
    toggleEditTAInfo();
    showSuccessMessage(); 
    
}


window.onresize = responsiveMessageChannel;
//Change the messages format based on screen size
function responsiveMessageChannel() {
  if (!window.matchMedia("(min-width: 950px)").matches) {
        //phone/tablet mode
        document.getElementById("responsiveMsgChannel").innerHTML = document.getElementById("messageChannelContents").innerHTML;
        document.getElementById("responsiveMsgChannel").style.display = "block";
        document.getElementById("messageChannel").style.display = "none";
        document.getElementById("openMessagesButton").style.display = "none";
        document.getElementById("closeMessagesButton").style.display = "none";
        closeMessages();

  } else { //PC mode
        document.getElementById("responsiveMsgChannel").innerHTML = "";
        document.getElementById("responsiveMsgChannel").style.display = "none";
        document.getElementById("messageChannel").style.display = "block";
        document.getElementById("openMessagesButton").style.display = "block";
        document.getElementById("closeMessagesButton").style.display = "block";
        closeMessages();
        
  }
}


function updateTAPerform()
{
    let TA_name = CURRENT_TA;
    let course_num = CURRENT_COURSE;
    let prof_name = CURRENT_PROF;
    let term_month_year = CURRENT_TERM + new Date().toLocaleDateString();
    let comment = document.getElementById("taPerform").value;
    if (comment.length > 0)
    {
        try{
        const req = new XMLHttpRequest();
        req.open("POST", "updateTAPerform.php", false);
        req.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        req.send(`TA_name=${TA_name}&course_num=${course_num}&prof_name=${prof_name}&term_month_year=${term_month_year}&comment=${comment}`);
        
        }catch (exception)
        {
            alert("Request failed.");
        }
        getTAPreform();
        //clear the input text box
        document.getElementById("taPerform").value = "";
        showSuccessMessage() 
    }
    
}

function displayWishList()
{
    let prof_name = CURRENT_PROF;
    let course_num = CURRENT_COURSE; //TODO
    try{
        const req = new XMLHttpRequest();
        req.open("POST", "displayWishList.php", false);
        req.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        req.send(`prof_name=${prof_name}&course_num=${course_num}`);
        let response = req.responseText;
        document.getElementById("wishList").innerHTML = response;
        
    }catch (exception)
    {
        alert("Request failed.");
    }
}

function updateTAWishList()
{
    let TA_name = document.getElementById("addToWishList").value;;
    let term_month_year = CURRENT_TERM + new Date().toLocaleDateString();
    let course_num = CURRENT_COURSE;
    let prof_name = CURRENT_PROF;
    if (TA_name.length > 0)
    {
        try{
        const req = new XMLHttpRequest();
        req.open("POST", "updateTAWishList.php", false);
        req.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        req.send(`TA_name=${TA_name}&course_num=${course_num}&prof_name=${prof_name}&term_month_year=${term_month_year}`);
        }catch (exception)
        {
            alert("Request failed.");
        }
        displayWishList();
        //clear the input text box
        document.getElementById("addToWishList").value = "";
        showSuccessMessage() 
    }
}

//display the TA dropdown info
window.onload = function()
{
    updateMessages();
    getTAs();
    displayWishList();
    responsiveMessageChannel();
}

function getTAs()
{
    let course = CURRENT_COURSE;
    try{
        const req = new XMLHttpRequest();
        req.open("POST", "selectTA.php", false);
        req.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        req.send(`course=${course}`);
        document.getElementById("TAselectionDropDown").innerHTML = req.responseText;
        
    }catch (exception)
    {
        alert("Request failed.");
    }
}

function getTAPreform()
{
    try{
        let course = CURRENT_COURSE;
        let TA_name = CURRENT_TA;
        let prof_name = CURRENT_PROF;
        console.log(course);
        console.log(TA_name);
        console.log(prof_name);
        const req = new XMLHttpRequest();
        req.open("POST", "taPerform.php", false);
        req.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        req.send(`TA_name=${TA_name}&course=${course}&prof_name=${prof_name}`);
        let response = req.responseText;
        document.getElementById("taPerformLogs").innerHTML = response;
        
    }catch (exception)
    {
        alert("Request failed.");
    }
}

function messageSent()
{
    let message = document.getElementById("msg").value;
    if (message.length > 0)
    {
        let username = "Maddy";
        var today = new Date();
        var date = today.getFullYear()+'/'+(today.getMonth()+1)+'/'+today.getDate();
        var time = today.getHours() + ":" + today.getMinutes();
        let dateAndTime = time+' on '+date;
        let course = "COMP307";//TODO
        
        try{
            
            const req = new XMLHttpRequest();
            req.open("POST", "messageSent.php", false);
            req.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            req.send(`username=${username}&course=${course}&dateAndTime=${dateAndTime}&message=${message}`);
            console.log(req.responseText);
        }catch (exception)
        {
            alert("Request failed.");
        }
        //clear the input and re-display the messages
        document.getElementById("msg").value = "";
        updateMessages();
    }
    
}

    //add an event listener to the input box, so pressing "enter" will also sent a message:
    document.getElementById("msg").addEventListener("keyup", function(event)
    {
        if (event.keyCode === 13) //enter key
        {
            event.preventDefault();
            messageSent();
        }
    });

    
    /**
     * Makes the selected topNav option have a border and removes all other borders
     * @param id the id of the topnavOption div
     */
    function menuItemSelected(id)
    {
        let items = document.getElementsByClassName("topNavOption");
        for (let i=0; i<items.length; i++)
        {
            let item = items[i];
            item.style.border = "none";
        }
        document.getElementById(id).style.border = "2px solid #8d99ae";
    }
    
    /**
     * Closes the drop down menu unless the click is within the dropdown menu
     * @param element
     */
    window.onclick = function(element) {
        if (!element.target.matches(".dropDownButton")) {
            let items = document.getElementsByClassName("dropDown_contents");
            for (let i=0; i<items.length; i++)
            {
                let item = items[i];
                item.style.display = "none";
            }
        }
    }

       
    /**
     * Opens or closes the dropdown menu associated with id.
     * @param id the id for a topNavOption
     */
    function toggleDropDown(id)
    {
        var d = document.getElementById(id);
        if (d.style.display === "none")
        {
            d.style.display = "block";
        }
        else
        {
            d.style.display = "none";
        }
    }

    function showTopNavOptions() {
        let options = document.getElementsByClassName("topNavOption");
        for (let i=0; i<options.length; i++)
        {
            let option = options[i];
            console.log(option.className);
            if (option.className === "topNavOption") 
            {
                option.className += " responsive";
            }   
            else 
            {
                option.className = "topNavOption";
            }
        }
        
    }

    //Open drop down to let user edit ta responsibilities and OH
    function toggleEditTAInfo()
    {
        let edit = document.getElementById("editInfo");
    
        if (edit.style.display == "none")
        {
            edit.style.display = "block";
            //Fill the "edit TA info" inputs with the current TA info, to make it more
            //convenient for editing purposes
            
        }
        else
        {
            edit.style.display = "none";
        }
    }

    


    
    </script>
    
    </body>
    </html>